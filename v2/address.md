# Addresses

Address identify a particular street location in the world. Addresses are used in two related but separate places in Houdini, as you'll see below

## Properties

Every address has the following properties:

- supporter_id: supporter the address belongs to

At least one of the address fields:
- address: the street address
- city
- state_code: state or region code
- zip_code: ZIP or postal code
- country: country code

Additionally, once saved, every address has the following autogenerated value:
- fingerprint: a hash based on the values of the previous fields (explained below)
- updated_at: a UTC time the address was last updated

## Fingerprint
Every address has a fingerprint. Two addresses that have an identical supporter_id AND identical address fields will have the same fingerprint. We use this in a couple places.


## Types
There are two types of addresses in Houdini. They're similar but in different parts of the database.

1. Transaction addresses
2. CRM addresses

### Transaction addresses
A transaction address is an address that belongs to a particular transaction (donation, ticket, etc). To that end, it has the following additional properties:

- transactionable: a polymorphic association with a particular transaction


#### Creating, updated and deleting
Transaction addresses are automatically created or updated when the corresponding transaction is edited as the address is a property on transactions.

Additionally, transaction addresses are automatically deleted when a transaction is edited and the address property is missing.

### CRM Addresses

CRM addresses belong directly to a supporter. Each supporter may have zero or more CRM addresses. A CRM Address has no additional properties but may be tagged as 'default'

#### Default
A default address is the address that is automatically used in cases where a supporter is exported in a CSV file. It's also included as the default_address on a supporter record. If a supporter has at least one CRM address, then one of the CRM addresses will ALWAYS be set as default. If a supporter has a CRM Address and doesn't have a manually defined default address, one will be selected automatically.

#### Updating and deleting
A CRM address can be updated or deleted via the api/v1/supporters/addresses/ endpoint or via the supporter dashboard

#### Creating

CRM addresses can be created one of two ways:

1. manually from the supporter dashboard
2. automatically from a transaction

##### Automatic creation
When a new transaction, with a transaction address is created, Houdini looks if there is a matching CRM Address, i.e. they both have the same fingerprint. If the transaction supporter does not already have a matching CRM address, then Houdini will create a matching CRM address.

NOTE: There is no additional relationship between the transaction address and CRM address after creation. No changes after creation to either entity will affect the other.


